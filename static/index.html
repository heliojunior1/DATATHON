<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Passos MÃ¡gicos â€” PrediÃ§Ã£o de Defasagem</title>
  <meta name="description" content="Dashboard de ML para previsÃ£o de risco de defasagem escolar">
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">ğŸ’</div>
        <div>
          <h2>Passos MÃ¡gicos</h2><span>ML Dashboard</span>
        </div>
      </div>
      <ul class="nav">
        <li><a onclick="navigate('dashboard')" class="active"><span class="nav-icon">ğŸ“Š</span>Dashboard</a></li>
        <li><a onclick="navigate('training')"><span class="nav-icon">ğŸ§ </span>Treinamento</a></li>
        <li><a onclick="navigate('predict')"><span class="nav-icon">ğŸ”</span>PrediÃ§Ã£o</a></li>
        <li><a onclick="navigate('batch')"><span class="nav-icon">ğŸ“‹</span>PrediÃ§Ã£o em Lote</a></li>
        <li><a onclick="navigate('monitoring')"><span class="nav-icon">ğŸ“ˆ</span>Monitoramento</a></li>
      </ul>
      <div class="sidebar-footer">v2.0.0 â€¢ Multi-Model</div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">

      <!-- ===== DASHBOARD ===== -->
      <div id="page-dashboard" class="page active">
        <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap">
          <h1 class="page-title" style="margin:0">Dashboard</h1>
          <select id="dash-model-select" onchange="loadDashboard()"
            style="padding:6px 12px;border-radius:8px;border:1px solid var(--border);background:var(--card-bg);color:var(--text1);font-size:14px"></select>
        </div>
        <p class="page-subtitle">VisÃ£o geral do modelo de previsÃ£o de risco de defasagem escolar</p>

        <div class="metrics-grid">
          <div class="metric-card purple">
            <div class="metric-label">Status</div>
            <div class="metric-value" style="font-size:20px" id="m-status">â€”</div>
            <div class="metric-sub" id="m-model">â€”</div>
          </div>
          <div class="metric-card green">
            <div class="metric-label">Accuracy</div>
            <div class="metric-value" id="m-accuracy">â€”</div>
            <div class="metric-sub" id="m-features">â€”</div>
          </div>
          <div class="metric-card blue">
            <div class="metric-label">F1-Score</div>
            <div class="metric-value" id="m-f1">â€”</div>
            <div class="metric-sub" id="m-samples">â€”</div>
          </div>
          <div class="metric-card amber">
            <div class="metric-label">AUC-ROC</div>
            <div class="metric-value" id="m-auc">â€”</div>
            <div class="metric-sub">Ãrea sob a curva</div>
          </div>
          <div class="metric-card green">
            <div class="metric-label">Recall</div>
            <div class="metric-value" id="m-recall">â€”</div>
            <div class="metric-sub">Sensibilidade</div>
          </div>
          <div class="metric-card purple">
            <div class="metric-label">Precision</div>
            <div class="metric-value" id="m-precision">â€”</div>
            <div class="metric-sub">PrecisÃ£o</div>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="card-title"><span class="card-icon">â­</span>Feature Importance (Top 12)</div>
            <div id="feat-bars"></div>
          </div>
          <div class="card">
            <div class="card-title"><span class="card-icon">ğŸ¯</span>Confusion Matrix</div>
            <div class="cm-grid">
              <div></div>
              <div class="cm-label">Pred: Sem Risco</div>
              <div class="cm-label">Pred: Em Risco</div>
              <div class="cm-label">Real:<br>Sem Risco</div>
              <div class="cm-cell cm-tn" id="cm-tn">â€”</div>
              <div class="cm-cell cm-fp" id="cm-fp">â€”</div>
              <div class="cm-label">Real:<br>Em Risco</div>
              <div class="cm-cell cm-fn" id="cm-fn">â€”</div>
              <div class="cm-cell cm-tp" id="cm-tp">â€”</div>
            </div>
          </div>
        </div>

        <!-- CV Results -->
        <div id="cv-section" class="card" style="display:none;margin-top:20px">
          <div class="card-title"><span class="card-icon">ğŸ”„</span>Cross-Validation (K-Fold)</div>
          <div class="metrics-grid" id="cv-metrics" style="grid-template-columns:repeat(5,1fr)"></div>
        </div>

        <!-- Learning Curves -->
        <div id="lc-section" class="card" style="display:none;margin-top:20px">
          <div class="card-title"><span class="card-icon">ğŸ“‰</span>Learning Curves â€” DiagnÃ³stico de Overfitting</div>
          <div style="text-align:center">
            <img id="lc-img" src="" alt="Learning Curves" style="max-width:100%;border-radius:8px;margin-top:10px">
          </div>
        </div>
      </div>

      <!-- ===== TREINAMENTO ===== -->
      <div id="page-training" class="page">
        <h1 class="page-title">ğŸ§  Treinamento de Modelo</h1>
        <p class="page-subtitle">Escolha o tipo de modelo, selecione as features e inicie o treinamento</p>

        <div class="card">
          <div class="card-title"><span class="card-icon">âš™ï¸</span>ConfiguraÃ§Ã£o do Modelo</div>
          <div class="form-grid" style="grid-template-columns:1fr 1fr 1fr">
            <div class="form-group">
              <label>Tipo de Modelo</label>
              <select id="train-model-type">
                <option value="xgboost">XGBoost</option>
                <option value="catboost">CatBoost</option>
                <option value="lightgbm">LightGBM</option>
                <option value="tabpfn">TabPFN</option>
              </select>
            </div>
            <div class="form-group">
              <label>Otimizar HiperparÃ¢metros</label>
              <select id="train-optimize">
                <option value="false">NÃ£o (rÃ¡pido ~10s)</option>
                <option value="true">Sim (RandomizedSearchCV ~60s)</option>
              </select>
            </div>
            <div class="form-group">
              <label>IteraÃ§Ãµes Busca</label>
              <input type="number" id="train-n-iter" value="50" min="10" max="200">
            </div>
          </div>
          <div class="form-grid" style="grid-template-columns:1fr 1fr 1fr;margin-top:10px">
            <div class="form-group">
              <label><input type="checkbox" id="train-cv" checked> K-Fold Cross-Validation</label>
            </div>
            <div class="form-group">
              <label><input type="checkbox" id="train-lc" checked> Learning Curves</label>
            </div>
            <div class="form-group">
              <label><input type="checkbox" id="train-ian"> Incluir IAN (âš ï¸ data leakage)</label>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ”¢</span>Selecionar Features
            <span style="float:right;font-size:13px">
              <a href="#" onclick="toggleAllFeatures(true);return false" style="color:var(--accent)">Selecionar
                Todas</a> |
              <a href="#" onclick="toggleAllFeatures(false);return false" style="color:var(--accent)">Limpar</a> |
              <a href="#" onclick="resetDefaultFeatures();return false" style="color:var(--accent)">PadrÃ£o</a>
            </span>
          </div>
          <div id="feature-selection" class="feature-grid"></div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="btn-train" onclick="submitTraining()">
            <div class="spinner"></div><span class="btn-text">ğŸš€ Treinar Modelo</span>
          </button>
        </div>

        <div id="train-results"></div>

        <!-- Modelos Treinados -->
        <div class="card" style="margin-top:20px">
          <div class="card-title"><span class="card-icon">ğŸ“¦</span>Modelos Treinados</div>
          <div id="trained-models-list"></div>
        </div>
      </div>

      <!-- ===== PREDIÃ‡ÃƒO ===== -->
      <div id="page-predict" class="page">
        <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap">
          <h1 class="page-title" style="margin:0">PrediÃ§Ã£o Individual</h1>
          <select id="predict-model-select"
            style="padding:6px 12px;border-radius:8px;border:1px solid var(--border);background:var(--card-bg);color:var(--text1);font-size:14px"></select>
        </div>
        <p class="page-subtitle">Preencha os dados do aluno para estimar o risco de defasagem escolar</p>

        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ“</span>Indicadores AcadÃªmicos</div>
          <div class="form-grid">
            <div class="form-group"><label>IAA (0-10)</label><input type="number" id="f-IAA" data-key="IAA" step="0.01"
                min="0" max="10"></div>
            <div class="form-group"><label>IEG (0-10)</label><input type="number" id="f-IEG" data-key="IEG" step="0.01"
                min="0" max="10"></div>
            <div class="form-group"><label>IPS (0-10)</label><input type="number" id="f-IPS" data-key="IPS" step="0.01"
                min="0" max="10"></div>
            <div class="form-group"><label>IDA (0-10)</label><input type="number" id="f-IDA" data-key="IDA" step="0.01"
                min="0" max="10"></div>
            <div class="form-group"><label>IPV (0-10)</label><input type="number" id="f-IPV" data-key="IPV" step="0.01"
                min="0" max="10"></div>
            <div class="form-group"><label>IAN (0, 5 ou 10)</label><input type="number" id="f-IAN" data-key="IAN"
                step="5" min="0" max="10"></div>
            <div class="form-group"><label>INDE 2022</label><input type="number" id="f-INDE_22" data-key="INDE 22"
                step="0.001" min="0" max="10"></div>
            <div class="form-group"><label>MatemÃ¡tica</label><input type="number" id="f-Matem" data-key="Matem"
                step="0.01" min="0" max="10"></div>
            <div class="form-group"><label>PortuguÃªs</label><input type="number" id="f-Portug" data-key="Portug"
                step="0.01" min="0" max="10"></div>
            <div class="form-group"><label>Tem nota InglÃªs?</label><select id="f-Tem_nota_ingles"
                data-key="Tem_nota_ingles">
                <option value="0">NÃ£o</option>
                <option value="1">Sim</option>
              </select></div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ‘¤</span>Dados do Aluno</div>
          <div class="form-grid">
            <div class="form-group"><label>Fase</label><select id="f-Fase" data-key="Fase">
                <option value="">Selecione</option>
                <option>Alfa</option>
                <option>Fase 1</option>
                <option>Fase 2</option>
                <option>Fase 3</option>
                <option>Fase 4</option>
                <option>Fase 5</option>
                <option>Fase 6</option>
                <option>Fase 7</option>
                <option>Fase 8</option>
              </select></div>
            <div class="form-group"><label>Idade (2022)</label><input type="number" id="f-Idade_22" data-key="Idade 22"
                min="6" max="25"></div>
            <div class="form-group"><label>GÃªnero</label><select id="f-Genero" data-key="GÃªnero">
                <option value="">Selecione</option>
                <option>Menina</option>
                <option>Menino</option>
              </select></div>
            <div class="form-group"><label>Escola</label><select id="f-Instituicao" data-key="InstituiÃ§Ã£o de ensino">
                <option value="">Selecione</option>
                <option>Escola PÃºblica</option>
                <option>Rede DecisÃ£o</option>
                <option>Escola JP II</option>
              </select></div>
            <div class="form-group"><label>Ano de Ingresso</label><input type="number" id="f-Ano_ingresso"
                data-key="Ano ingresso" min="2016" max="2023"></div>
            <div class="form-group"><label>Pedra 2022</label><select id="f-Pedra_22" data-key="Pedra 22">
                <option value="">Selecione</option>
                <option>Quartzo</option>
                <option>Ãgata</option>
                <option>Ametista</option>
                <option>TopÃ¡zio</option>
              </select></div>
            <div class="form-group"><label>Atingiu PV</label><select id="f-Atingiu_PV" data-key="Atingiu PV">
                <option value="">Selecione</option>
                <option>Sim</option>
                <option>NÃ£o</option>
              </select></div>
            <div class="form-group"><label>Indicado</label><select id="f-Indicado" data-key="Indicado">
                <option value="">Selecione</option>
                <option>Sim</option>
                <option>NÃ£o</option>
              </select></div>
          </div>
        </div>

        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ“Š</span>ClassificaÃ§Ã£o & AvaliaÃ§Ã£o</div>
          <div class="form-grid">
            <div class="form-group"><label>Cf (ranking fase)</label><input type="number" id="f-Cf" data-key="Cf" min="1"
                max="200"></div>
            <div class="form-group"><label>Ct (ranking turma)</label><input type="number" id="f-Ct" data-key="Ct"
                min="1" max="30"></div>
            <div class="form-group"><label>NÂº AvaliaÃ§Ãµes</label><input type="number" id="f-Num_Av" data-key="NÂº Av"
                min="1" max="4"></div>
            <div class="form-group"><label>Destaque IEG</label><select id="f-Destaque_IEG" data-key="Destaque IEG">
                <option value="">Selecione</option>
                <option value="Destaque IEG">Sim</option>
                <option>NÃ£o</option>
              </select></div>
            <div class="form-group"><label>Destaque IDA</label><select id="f-Destaque_IDA" data-key="Destaque IDA">
                <option value="">Selecione</option>
                <option value="Destaque IDA">Sim</option>
                <option>NÃ£o</option>
              </select></div>
            <div class="form-group"><label>Destaque IPV</label><select id="f-Destaque_IPV" data-key="Destaque IPV">
                <option value="">Selecione</option>
                <option value="Destaque IPV">Sim</option>
                <option>NÃ£o</option>
              </select></div>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="btn-predict" onclick="submitPrediction()">
            <div class="spinner"></div><span class="btn-text">ğŸ” Prever Risco</span>
          </button>
          <button class="btn btn-secondary" onclick="fillExample()">ğŸ“ Exemplo</button>
          <button class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ Limpar</button>
        </div>

        <div id="result-card" class="result-card">
          <div class="result-header"><span id="r-badge" class="result-badge">â€”</span></div>
          <div id="r-prob" class="result-prob">â€”</div>
          <div id="r-level" class="result-level">â€”</div>
          <div class="card-title"><span class="card-icon">â­</span>Fatores Principais</div>
          <div id="r-factors"></div>
        </div>
      </div>

      <!-- ===== BATCH ===== -->
      <div id="page-batch" class="page">
        <h1 class="page-title">PrediÃ§Ã£o em Lote</h1>
        <p class="page-subtitle">Envie dados de mÃºltiplos alunos em formato JSON para prediÃ§Ã£o simultÃ¢nea</p>
        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ“‹</span>Dados dos Alunos (JSON Array)</div>
          <textarea id="batch-json"
            placeholder='[&#10;  { "IAA": 7.5, "IEG": 8.0, ... },&#10;  { "IAA": 3.2, "IEG": 4.1, ... }&#10;]'></textarea>
          <div class="btn-group">
            <button class="btn btn-primary" id="btn-batch" onclick="submitBatch()">
              <div class="spinner"></div><span class="btn-text">ğŸš€ Processar Lote</span>
            </button>
            <button class="btn btn-secondary" onclick="loadBatchExample()">ğŸ“ Carregar Exemplo</button>
          </div>
        </div>
        <div id="batch-results"></div>
      </div>

      <!-- ===== MONITORING ===== -->
      <div id="page-monitoring" class="page">
        <h1 class="page-title">Monitoramento</h1>
        <p class="page-subtitle">Acompanhe drift de dados e estatÃ­sticas de prediÃ§Ã£o em tempo real</p>
        <div class="metrics-grid">
          <div class="metric-card blue">
            <div class="metric-label">PrediÃ§Ãµes</div>
            <div class="metric-value" id="mon-total">0</div>
          </div>
          <div class="metric-card red">
            <div class="metric-label">Taxa de Risco</div>
            <div class="metric-value" id="mon-risk-rate">â€”</div>
          </div>
          <div class="metric-card amber">
            <div class="metric-label">Probabilidade MÃ©dia</div>
            <div class="metric-value" id="mon-avg-prob">â€”</div>
          </div>
          <div class="metric-card purple">
            <div class="metric-label">Drift Status</div>
            <div class="metric-value" style="font-size:16px"><span id="mon-drift-status"
                class="drift-status drift-warn">â€”</span></div>
          </div>
        </div>
        <div class="card">
          <div class="card-title"><span class="card-icon">ğŸ”¬</span>Drift por Feature</div>
          <div id="drift-details"></div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="loadMonitoring()">ğŸ”„ Atualizar</button>
        </div>
      </div>
    </main>
  </div>

  <div id="toast" class="toast"></div>
  <script src="/static/app.js"></script>
</body>

</html>